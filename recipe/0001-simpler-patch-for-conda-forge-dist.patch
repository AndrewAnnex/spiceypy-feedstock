From 58c0100f263d025037a75d0047b75e674e60137b Mon Sep 17 00:00:00 2001
From: AndrewAnnex <ama6fy@virginia.edu>
Date: Thu, 9 Jan 2020 22:41:35 -0500
Subject: [PATCH 1/2] simpler patch for conda forge dist

---
 setup.py                         |  9 ---------
 spiceypy/utils/libspicehelper.py | 10 ++++------
 2 files changed, 4 insertions(+), 15 deletions(-)

diff --git a/setup.py b/setup.py
index f6bcf12..283b8b0 100644
--- a/setup.py
+++ b/setup.py
@@ -102,13 +102,6 @@ class BuildPyCommand(build_py):
         build_py.run(self)
 
 
-cmdclass = {
-    "install": InstallSpiceyPy,
-    "test": PyTest,
-    "build_py": BuildPyCommand,
-    "get_cspice": GetCSPICECommand,
-}
-
 readme = open("README.rst", "r")
 readmetext = readme.read()
 readme.close()
@@ -141,13 +134,11 @@ setup(
     packages=["spiceypy", "spiceypy.utils"],
     include_package_data=True,
     zip_safe=False,
-    distclass=SpiceyPyBinaryDistribution,
     package_data={"spiceypy": ["utils/*.so", "utils/*.dll"]},
     setup_requires=DEPENDENCIES,
     install_requires=DEPENDENCIES,
     requires=REQUIRES,
     tests_require=TEST_DEPENDENCIES,
-    cmdclass=cmdclass,
     test_suite="spiceypy.tests.test_wrapper.py",
     extras_require={"testing": ["pytest"]},
 )
diff --git a/spiceypy/utils/libspicehelper.py b/spiceypy/utils/libspicehelper.py
index 628bd75..7e1b0cf 100644
--- a/spiceypy/utils/libspicehelper.py
+++ b/spiceypy/utils/libspicehelper.py
@@ -23,15 +23,13 @@ SOFTWARE.
 """
 
 from ctypes import CDLL, POINTER, c_int, c_double, c_char, c_char_p, c_void_p
-import os
-import platform
+from ctypes.util import find_library
 from . import support_types as stypes
 from . import callbacks
 
-host_OS = platform.system()
-sharedLib = "cspice.dll" if host_OS == "Windows" else "spice.so"
-sitePath = os.path.join(os.path.dirname(__file__), sharedLib)
-libspice = CDLL(sitePath)
+# Simpler function find_library won't work at the moment, see
+# https://github.com/conda-forge/cspice-feedstock/issues/4
+libspice = CDLL(find_library("cspice"))
 
 s_cell_p = POINTER(stypes.SpiceCell)
 s_elip_p = POINTER(stypes.Ellipse)
-- 
2.16.2

